#ifndef __CINT__#endif#include "TLatex.h"#include "TCanvas.h"#include "TROOT.h"#include "TAxis.h"#include "TH1.h"#include "TTree.h"#include "TFile.h"#include "TH1D.h"#include "TH2D.h"#include "TF1.h"#include "TH1I.h"#include "TCanvas.h"#include "TLine.h"#include "TMath.h"#include "TVector3.h"#include "TString.h"#include "TLegend.h"#include "TChain.h"#include "TCut.h"#include "TLegendEntry.h"#include "TPaveStats.h"#include "RooGenericPdf.h"#include "RooRealVar.h"#include "RooDataSet.h"#include "RooAddPdf.h"#include "RooGaussian.h"#include "RooChebychev.h"#include "RooCBShape.h"#include "RooPlot.h"#include "RooMCStudy.h"#include "RooFitResult.h"#include "RooWorkspace.h"#include "RooKeysPdf.h"#include "RooStats/ModelConfig.h"#include "RooStats/ProfileLikelihoodCalculator.h"#include "RooStats/LikelihoodInterval.h"#include "RooStats/LikelihoodIntervalPlot.h"#include "RooRealVar.h"#include "RooDataSet.h"#include "RooGaussian.h"#include "RooFitResult.h"#include "RooLandau.h"#include "RooChebychev.h"#include "RooAddPdf.h"#include "RooPlot.h"#include "RooDataHist.h"#include "RooVoigtian.h"#include "RooCBShape.h"#include "RooArgusBG.h"#include "RooPolynomial.h"#include "RooExponential.h"#include "RooBinning.h"#include "RooHist.h"#include "TRandom.h"#include "TStyle.h"#include "TSystem.h"#include "TGraphErrors.h"#include <fstream>#include <map>#include <string>#include <iostream>#include <stdio.h>#include <string.h>#include <TObjArray.h>#include <TLorentzVector.h>#include <TClonesArray.h>bool IsAccept(Double_t pt, Double_t eta); //you can define acceptance here bool IspAaccept(Double_t Rap,Double_t eta1,Double_t eta2); //you can define acceptance here double findNcoll(int hiBin);double FindCenWeight(int Bin);void lJpsiTune2015_Loop(int loop);bool isplot =1;bool CB =0;bool CBG=1;Double_t massMin=0.0,massMax=0.0;double BkgPDF = 6;void lJpsiTune2015(){  for(int i=0;i<1;i++){    lJpsiTune2015_Loop(i);  }}void lJpsiTune2015_Loop(int loop){  //double ymin=0,ymax=0,pmin=0,pmax=0;  double DRatio[20] = {0}, DRatioEr[20] = {0};   TH1::AddDirectory(kFALSE);  gStyle->SetCanvasDefH(600);  gStyle->SetCanvasDefW(600);    gROOT->SetStyle("Plain");  gStyle->SetPalette(1);  gStyle->SetFrameBorderMode(0);  gStyle->SetFrameFillColor(0);  gStyle->SetCanvasColor(0);  gStyle->SetTitleFillColor(0);  gStyle->SetStatColor(0);  gStyle->SetPadBorderSize(0);  gStyle->SetCanvasBorderSize(0);  gStyle->SetOptTitle(0); // at least most of the time  gStyle->SetOptStat("nemr"); // most of the time, sometimes "nemriou" might be useful to display name,   //number of entries, mean, rms, integral, overflow and underflow  gStyle->SetOptFit(0); // set to 1 only if you want to display fit results    //=================================== Histo for all cut variables ==========================================  using namespace RooFit;  using namespace RooStats;   void setWSRange(RooWorkspace *ws);  void defineMassBkg(RooWorkspace *ws);  void defineMassSig(RooWorkspace *ws);      double RError(double,double,double,double);  double WeightRatioError(double,double,double,double);    bool is3D =1;  bool significance = 1;  bool isHI=0;   bool savePlot=1;    float ptmin=3.0; float ptmax=30.0; float ymin=1.6; float ymax=2.4; bool absRapidity=true;   double threshold=0.8; double efficiency=0.9; int centmin=80; int centmax=200;  //ymin=1.6; ymax=2.4; ptmin=3.0; ptmax=6.5;   //ymin=1.6; ymax=2.4; ptmin=6.5; ptmax=9.0;      //ymin=1.6; ymax=2.4; ptmin=3.0; ptmax=9.0;   //ymin=0.0; ymax=1.6; ptmin=6.5; ptmax=9.0;    //ymin=1.6; ymax=2.4; ptmin=3.0; ptmax=30.0;   ymin=0.0; ymax=1.6; ptmin=6.5; ptmax=30.0;      int range1 = 0; int fbin = 0;  int range2 = 0; int lbin = 0;  float xVal = 0.0;  if(significance){    range1 = -10;    range2 = 50;    fbin = -10; lbin = 50;    xVal = 11.0;  }else{    range1 = -1;    range2 = 3;    fbin = -5; lbin = 10;    xVal = 0.5;  }  float lCut=-10.0;  TLegend *leg = new TLegend(0.42,0.4,0.95,0.6);  if (isHI)    leg->SetHeader("PYTHIA: PbPb #sqrt{s_{NN}} = 5.02 TeV");  else    leg->SetHeader("PYTHIA: pp #sqrt{s} = 5.02 TeV");  leg->SetFillStyle(0);  leg->SetFillColor(0);  leg->SetBorderSize(0);  leg->SetMargin(0.15);  leg->SetTextSize(0.032);  TCut defaultCut = NULL;  //  TCut defaultCut = "Reco_QQ_sign==0&&Gen_QQ_4mom.M()>3.09&&Gen_QQ_4mom.M()<3.10&&Reco_QQ_4mom.M()>2.9&&Reco_QQ_4mom.M()<3.2&&Reco_QQ_ctauTrue>-10";  defaultCut = "Reco_QQ_sign==0&&Reco_QQ_4mom.M()>2.9&&Reco_QQ_4mom.M()<3.2&&Reco_QQ_ctau>-500&&Reco_QQ_ctauTrue>-10";  if(significance)    defaultCut = "Reco_QQ_sign==0&&Reco_QQ_4mom.M()>2.85&&Reco_QQ_4mom.M()<3.25&&Reco_QQ_ctau>-500&&Reco_QQ_ctauErr>-500&&Reco_QQ_ctauTrue>-10";  if(is3D){    defaultCut = "Reco_QQ_sign==0&&Reco_QQ_4mom.M()>2.85&&Reco_QQ_4mom.M()<3.25&&Reco_QQ_ctau3D>-500&&Reco_QQ_ctauTrue3D>-10";    if(significance)      defaultCut = "Reco_QQ_sign==0&&Reco_QQ_4mom.M()>2.85&&Reco_QQ_4mom.M()<3.25&&Reco_QQ_ctau3D>-500&&Reco_QQ_ctauErr3D>-500&&Reco_QQ_ctauTrue3D>-10";  }    TCut ptCut = Form("Reco_QQ_4mom.Pt()>%3.1f&&Reco_QQ_4mom.Pt()<%3.1f",ptmin,ptmax);  TCut rapCut;  if (absRapidity)    rapCut = Form("abs(Reco_QQ_4mom.Rapidity())>%3.1f&&abs(Reco_QQ_4mom.Rapidity())<%3.1f",ymin,ymax);  else    rapCut = Form("Reco_QQ_4mom.Rapidity()>%3.1f&&Reco_QQ_4mom.Rapidity()<%3.1f",ymin,ymax);  TCut centCut;  if (isHI)    centCut = Form("Centrality>=%d&&Centrality<%d",centmin,centmax);    // new Acceptance  TCut IsPlAccept = "(abs(Reco_QQ_mupl_4mom->Eta()) < 2.4 && ( (abs(Reco_QQ_mupl_4mom->Eta()) < 1.2 && Reco_QQ_mupl_4mom->Pt() >= 3.5 ) || (1.2 <= abs(Reco_QQ_mupl_4mom->Eta()) && abs(Reco_QQ_mupl_4mom->Eta()) < 2.1 && Reco_QQ_mupl_4mom->Pt() >= 5.77-1.89*abs(Reco_QQ_mupl_4mom->Eta() )) || (2.1 <= abs(Reco_QQ_mupl_4mom->Eta()) && Reco_QQ_mupl_4mom->Pt() >= 1.8 )))";  TCut IsMiAccept = "(abs(Reco_QQ_mumi_4mom->Eta()) < 2.4 && ( (abs(Reco_QQ_mumi_4mom->Eta()) < 1.2 && Reco_QQ_mumi_4mom->Pt() >= 3.5 ) || (1.2 <= abs(Reco_QQ_mumi_4mom->Eta()) && abs(Reco_QQ_mumi_4mom->Eta()) < 2.1 && Reco_QQ_mumi_4mom->Pt() >= 5.77-1.89*abs(Reco_QQ_mumi_4mom->Eta() )) || (2.1 <= abs(Reco_QQ_mumi_4mom->Eta()) && Reco_QQ_mumi_4mom->Pt() >= 1.8 )))";  TCut MuPlID = "((Reco_QQ_mupl_isGoodMuon==1) && Reco_QQ_mupl_nTrkWMea> 5 &&  Reco_QQ_mupl_nPixWMea > 0 && TMath::Abs(Reco_QQ_mupl_dxy) < 0.3 && TMath::Abs(Reco_QQ_mupl_dz) < 20 && Reco_QQ_VtxProb > 0.01 )";  TCut MuMiID = "((Reco_QQ_mumi_isGoodMuon==1) && Reco_QQ_mumi_nTrkWMea> 5 &&  Reco_QQ_mumi_nPixWMea > 0 && TMath::Abs(Reco_QQ_mumi_dxy) < 0.3 && TMath::Abs(Reco_QQ_mumi_dz) < 20 && Reco_QQ_VtxProb > 0.01 )";      unsigned int trigBit;  if (isHI)    trigBit=1; // DoubleMu0_HighQ  else    trigBit=1; // DoubleMu0_HighQ  TCut trigCut = Form("(HLTriggers&%u)==%u&&(Reco_QQ_trig&%u)==%u",trigBit,trigBit,trigBit,trigBit);  TString fname;  TString fnamepng;  TString outfname;  TString plotDir;    if(!is3D){plotDir = "Plots/2015";}  if(!is3D && significance){plotDir = "Plots/2015/significance";}  if(is3D){plotDir = "Plots/2015/3D";}  if(is3D && significance){plotDir = "Plots/2015/3D/significance";}    if (isHI) {    //    fname = "PbPb_eff_" + efficiency + "_Rap_" + ymin + "-" + ymax + "_Pt_" + ptmin + "-" + ptmax + ".pdf";    fname = Form("/Jpsi_PbPb_eff_%3.1f_Rap_%3.1f-%3.1f_Pt_%3.1f-%3.1f_Cent_%d-%d.pdf",efficiency,ymin,ymax,ptmin,ptmax,int(centmin/2.0),int(centmax/2.0));    fnamepng = Form("/Jpsi_PbPb_eff_%3.1f_Rap_%3.1f-%3.1f_Pt_%3.1f-%3.1f_Cent_%d-%d.png",efficiency,ymin,ymax,ptmin,ptmax,int(centmin/2.0),int(centmax/2.0));    outfname = Form("/Jpsi_PbPb_eff_%3.1f_Rap_%3.1f-%3.1f_Pt_%3.1f-%3.1f_Cent_%d-%d.root",efficiency,ymin,ymax,ptmin,ptmax,int(centmin/2.0),int(centmax/2.0));  }   else {    fname = Form("/Jpsi_pp_eff_%3.1f_Rap_%3.1f-%3.1f_Pt_%3.1f-%3.1f.pdf",efficiency,ymin,ymax,ptmin,ptmax);    fnamepng = Form("/Jpsi_pp_eff_%3.1f_Rap_%3.1f-%3.1f_Pt_%3.1f-%3.1f.png",efficiency,ymin,ymax,ptmin,ptmax);    outfname = Form("/Jpsi_pp_eff_%3.1f_Rap_%3.1f-%3.1f_Pt_%3.1f-%3.1f.root",efficiency,ymin,ymax,ptmin,ptmax);  }  std::cout << fname << std::endl;  std::cout << "default: " << defaultCut.GetTitle() << std::endl;  std::cout << "pt cut: " << ptCut.GetTitle() << std::endl;  std::cout << "rapidity cut: " << rapCut.GetTitle() << std::endl;  std::cout << "centrality cut: " << centCut.GetTitle() << std::endl;  std::cout << "trigger bit: " << trigCut.GetTitle() << std::endl;  TLatex *lpt;  if (ptmin==0.0)    lpt = new TLatex(0.5,0.80,Form("p_{T} < %3.1f GeV/c",ptmax));  else{    lpt = new TLatex(0.5,0.80,Form("%3.1f < p_{T} < %3.1f GeV/c",ptmin,ptmax));    lpt->SetTextSize(0.033);  }  TLatex *lrap;  if (absRapidity){    if (ymin==0.0){      lrap = new TLatex(0.5,0.75,Form("|y| < %3.1f",ymax));      lrap->SetTextSize(0.033);    }    else{      lrap = new TLatex(0.5,0.75,Form("%3.1f < |y| < %3.1f",ymin,ymax));      lrap->SetTextSize(0.033);    }  }  else {    if (ymin==0.0)      lrap = new TLatex(0.5,0.75,Form("y < %3.1f",ymax));    else      lrap = new TLatex(0.5,0.75,Form("%3.1f < y < %3.1f",ymin,ymax));  }  lpt->SetNDC(kTRUE);  lrap->SetNDC(kTRUE);    TLatex *lcent = NULL;  if (isHI) {    lcent = new TLatex(0.5,0.70,Form("Cent. %d-%d%%",int(centmin/2.0),int(centmax/2.0)));    lcent->SetTextSize(0.033);    lcent->SetNDC(kTRUE);  }  TCanvas *c1 = new TCanvas("c1","c1",1000,600);  c1->Divide(2,1);  c1->GetPad(1)->SetLogy();  c1->cd(1);  //  TCut prompt_weight = ;  //  TCut nonprompt_weight = "((Gen_QQ_4mom.Pt()<3.0)*(1.0/171458.0))||((Gen_QQ_4mom.Pt()>3.0&&Gen_QQ_4mom.Pt()<6.0)*(2.25*0.623/172208.0))||((Gen_QQ_4mom.Pt()>6.0&&Gen_QQ_4mom.Pt()<9.0)*(2.55*0.245/171178.0))||((Gen_QQ_4mom.Pt()>9.0&&Gen_QQ_4mom.Pt()<12.0)*(2.45*0.080/172208.0))||((Gen_QQ_4mom.Pt()>12.0&&Gen_QQ_4mom.Pt()<15.0)*(2.0*0.0299/170670.0))||((Gen_QQ_4mom.Pt()>15.0&&Gen_QQ_4mom.Pt()<30.0)*(3.35*0.0109/169302.0))"  TChain *NPTree = NULL;  if (isHI) {    NPTree = new TChain("myTree");    NPTree->Add("/home/abdulla/CMS/quarkoniaData/Charm2015/rootfiles/MC/PbPb/OniaTree_BJpsiMM_5p02TeV_TuneCUETP8M1_ptJpsi36_noCUT.root");    NPTree->Add("/home/abdulla/CMS/quarkoniaData/Charm2015/rootfiles/MC/PbPb/OniaTree_BJpsiMM_5p02TeV_TuneCUETP8M1_ptJpsi69_noCUT.root");  }  else{    NPTree = new TChain("hionia/myTree");    NPTree->Add("/home/abdulla/CMS/quarkoniaData/Charm2015/rootfiles/MC/pp/OniaTree_BJpsiMM_pp5p02TeV_TuneCUETP8M1_noCUT.root");  }  TH1F *hNP = new TH1F("hNP","hNP;l_{J/#psi} (mm);counts",1500,fbin,lbin);  hNP->Sumw2();  hNP->SetLineColor(2);  hNP->GetXaxis()->SetRangeUser(range1,range2);  TH1F* hNPCut = (TH1F*) hNP->Clone("hNPCut");  TH1F* hNPEff = (TH1F*) hNP->Clone("hNPEff");  hNPCut->GetYaxis()->SetTitle("#varepsilon_{prompt} or 1-#varepsilon_{non-prompt}");  hNPEff->GetYaxis()->SetTitle("#varepsilon_{non-prompt}");  //hNP->SetDirectory(0);  //TH1::AddDirectory(kFALSE);  if(isHI){    if(significance){      if(is3D)	NPTree->Draw("Reco_QQ_ctau3D/Reco_QQ_ctauErr3D>>hNP(1500,-10,50)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	NPTree->Draw("Reco_QQ_ctau/Reco_QQ_ctauErr>>hNP(1500,-10,50)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");    }    else{      if(is3D)	NPTree->Draw("Reco_QQ_ctau3D>>hNP(1500,-5,10)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	NPTree->Draw("Reco_QQ_ctau>>hNP(1500,-5,10)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");    }  }  else{    if(significance){      if(is3D)	NPTree->Draw("Reco_QQ_ctau3D/Reco_QQ_ctauErr3D>>hNP(1500,-10,50)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	NPTree->Draw("Reco_QQ_ctau/Reco_QQ_ctauErr>>hNP(1500,-10,50)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");    }    else{      if(is3D)	NPTree->Draw("Reco_QQ_ctau3D>>hNP(1500,-5,10)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	NPTree->Draw("Reco_QQ_ctau>>hNP(1500,-5,10)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");     }  }      // now we have full use of the histogram  hNP = (TH1F*)gPad->GetPrimitive("hNP");  //(TH1F*)gDirectory->Get("hNP");  cout<<hNP->GetEntries()<<endl;  TChain *PRTree = NULL;;  if (isHI) {    PRTree = new TChain("myTree");    PRTree->Add("/home/abdulla/CMS/quarkoniaData/Charm2015/rootfiles/MC/PbPb/OniaTree_JpsiMM_5p02TeV_TuneCUETP8M1_ptJpsi36_noCUT.root");    PRTree->Add("/home/abdulla/CMS/quarkoniaData/Charm2015/rootfiles/MC/PbPb/OniaTree_JpsiMM_5p02TeV_TuneCUETP8M1_ptJpsi69_noCUT.root");  }  else{    PRTree = new TChain("hionia/myTree");    PRTree->Add("/home/abdulla/CMS/quarkoniaData/Charm2015/rootfiles/MC/pp/OniaTree_JpsiMM_pp5p02TeV_TuneCUETP8M1_noCUT_v2.root");  }    TH1F *hPR = new TH1F("hPR","hPR;l_{J/#psi} (mm);counts",1500,fbin,lbin);  hPR->Sumw2();  hPR->SetLineColor(1);  TH1F* hPRCut = (TH1F*) hPR->Clone("hPRCut");    if(isHI){    if(significance){      if(is3D)	PRTree->Draw("Reco_QQ_ctau3D/Reco_QQ_ctauErr3D>>hPR(1500,-10,50)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	PRTree->Draw("Reco_QQ_ctau/Reco_QQ_ctauErr>>hPR(1500,-10,50)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");    }    else{      if(is3D)	PRTree->Draw("Reco_QQ_ctau3D>>hPR(1500,-5,10)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	PRTree->Draw("Reco_QQ_ctau>>hPR(1500,-5,10)",defaultCut&&ptCut&&rapCut&&centCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");    }  }  else{    if(significance){      if(is3D)	PRTree->Draw("Reco_QQ_ctau3D/Reco_QQ_ctauErr3D>>hPR(1500,-10,50)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	PRTree->Draw("Reco_QQ_ctau/Reco_QQ_ctauErr>>hPR(1500,-10,50)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");    }    else{      if(is3D)	PRTree->Draw("Reco_QQ_ctau3D>>hPR(1500,-5,10)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");      else	PRTree->Draw("Reco_QQ_ctau>>hPR(1500,-5,10)",defaultCut&&ptCut&&rapCut&&trigCut&&IsPlAccept&&IsMiAccept&&MuPlID&&MuMiID,"e");     }  }    hPR = (TH1F*)gPad->GetPrimitive("hPR");  //(TH1F*)gDirectory->Get("hNP");  cout<<hPR->GetEntries()<<endl;    if (!isHI) {    hNP->Scale(1.0/hNP->GetEntries());    hPR->Scale(1.0/hPR->GetEntries());  }    hNP->SetStats(0);  hNP->SetMaximum(0.2);  hNP->SetLineColor(2);  //hNP->GetXaxis()->SetTitle("l_{J/#psi} (mm)");  hNP->GetXaxis()->SetTitle("c#tau^{3D} (mm)");  if(significance) hNP->GetXaxis()->SetTitle("c#tau^{3D}/err_c#tau^{3D}");  hNP->GetXaxis()->SetRangeUser(range1,range2);  hNP->GetYaxis()->SetRangeUser(3.2e-5,0.2);  if(isHI){hNP->GetYaxis()->SetRangeUser(1.1e-7,0.2e-4);} //1.2e-7,3.2e-4  hNP->Draw("hist");  hPR->SetLineColor(1);  hPR->Draw("histsame");  leg->AddEntry(hPR,"Prompt J/#psi","L");  lpt->Draw();  lrap->Draw();    if (isHI)    lcent->Draw();  c1->cd(2);  leg->AddEntry(hNP,"Non-prompt J/#psi","L");  bool stillLooking = true;  int lCutBin=0;  for (int i=1;i<=hNP->GetNbinsX();++i) {    hNPCut->SetBinContent(i,hNP->Integral(i,hNP->GetNbinsX()+1)/hNP->Integral(1,hNP->GetNbinsX()+1));    hNPEff->SetBinContent(i,hNP->Integral(1,i)/hNP->Integral(1,hNP->GetNbinsX()+1));    hNPCut->SetBinError(i,0.0);    hNPEff->SetBinError(i,0.0);    if (hNPCut->GetBinContent(i)<threshold && stillLooking) {      lCut = hNPCut->GetBinLowEdge(i);      lCutBin = i;      stillLooking = false;    }  }    hNPCut->SetStats(0);  hNPCut->GetXaxis()->SetRangeUser(range1,range2);  hNPCut->GetXaxis()->SetTitle("c#tau^{3D} (mm)");  if(significance) hNPCut->GetXaxis()->SetTitle("c#tau^{3D}/err_c#tau^{3D}");  hNPCut->Draw("hist");  for (int i=1;i<=hPR->GetNbinsX();++i) {    hPRCut->SetBinContent(i,hPR->Integral(1,i)/hPR->Integral(1,hPR->GetNbinsX()+1));    hPRCut->SetBinError(i,0.0);  }  hPRCut->GetXaxis()->SetRangeUser(range1,range2);  hPRCut->Draw("histsame");  cout<<endl<<"-----------------------------------"<<endl;  cout<<hNPCut->GetEntries()<<endl;  cout<<hPRCut->GetEntries()<<endl;  TH1F *hRatio = (TH1F*) hNPEff->Clone("hRatio");  TH1F *hRatio_fb1 = (TH1F*) hNPEff->Clone("hRatio_fb1");  TH1F *hRatio_fb2 = (TH1F*) hNPEff->Clone("hRatio_fb2");  TH1F *hRatio_fb3 = (TH1F*) hNPEff->Clone("hRatio_fb3");  TH1F *hRatio_fb5 = (TH1F*) hNPEff->Clone("hRatio_fb5");  TH1F *hRatio_fb7 = (TH1F*) hNPEff->Clone("hRatio_fb7");  hRatio->Divide(hPRCut);  hRatio->SetLineColor(4);  //  hRatio->Draw("histsame");  for (int i=1;i<=hRatio_fb1->GetNbinsX();++i) {    if (hPRCut->GetBinContent(i)>0.0) {      hRatio_fb1->SetBinContent(i, 0.9*hPRCut->GetBinContent(i)/sqrt(0.1*hNPEff->GetBinContent(i)+0.9*hPRCut->GetBinContent(i)) );      hRatio_fb2->SetBinContent(i, 0.8*hPRCut->GetBinContent(i)/sqrt(0.2*hNPEff->GetBinContent(i)+0.8*hPRCut->GetBinContent(i)) );      hRatio_fb3->SetBinContent(i, 0.7*hPRCut->GetBinContent(i)/sqrt(0.3*hNPEff->GetBinContent(i)+0.7*hPRCut->GetBinContent(i)) );      hRatio_fb5->SetBinContent(i, 0.5*hPRCut->GetBinContent(i)/sqrt(0.5*hNPEff->GetBinContent(i)+0.5*hPRCut->GetBinContent(i)) );      hRatio_fb7->SetBinContent(i, 0.3*hPRCut->GetBinContent(i)/sqrt(0.7*hNPEff->GetBinContent(i)+0.3*hPRCut->GetBinContent(i)) );    }    else {      hRatio_fb1->SetBinContent(i,0.0);      hRatio_fb2->SetBinContent(i,0.0);      hRatio_fb3->SetBinContent(i,0.0);      hRatio_fb5->SetBinContent(i,0.0);      hRatio_fb7->SetBinContent(i,0.0);    }     hRatio_fb1->SetBinError(i,0.0);    hRatio_fb2->SetBinError(i,0.0);    hRatio_fb3->SetBinError(i,0.0);    hRatio_fb5->SetBinError(i,0.0);    hRatio_fb7->SetBinError(i,0.0); }  hRatio_fb1->SetLineColor(1);  hRatio_fb2->SetLineColor(2);  hRatio_fb3->SetLineColor(4);  hRatio_fb5->SetLineColor(kGreen+2);  hRatio_fb7->SetLineColor(kOrange+2);  std::cout << "\nFixing rejection:" << std::endl;  std::cout << "Non-prompt J/psi rejection of " << threshold << " at l_Jpsi = " << lCut << std::endl;  std::cout << "Prompt J/psi efficiency of " <<  hPRCut->GetBinContent(lCutBin) << " at l_Jpsi = " << lCut << std::endl;  stillLooking = true;  for (int i=1;i<=hPRCut->GetNbinsX();++i) {    if (hPRCut->GetBinContent(i)>efficiency && stillLooking) {      lCut = hPRCut->GetBinLowEdge(i);      lCutBin = i;      break;    }  }  std::cout << "\nFixing efficiency:" << std::endl;  std::cout << "Non-prompt J/psi rejection of " <<  hNPCut->GetBinContent(lCutBin) << " at l_Jpsi = " << lCut << std::endl;  std::cout << "Prompt J/psi efficiency of " <<  efficiency << " at l_Jpsi = " << lCut << std::endl;  TLine *l1 = new TLine(range1,hNPCut->GetBinContent(lCutBin),lCut,hNPCut->GetBinContent(lCutBin));  l1->SetLineStyle(2);  l1->SetLineColor(2);  l1->Draw();  TLine *l2 = new TLine(lCut,0.0,lCut,1.0);  l2->SetLineStyle(2);  l2->Draw();  TLine *l3 = new TLine(range1,efficiency,lCut,efficiency);  l3->SetLineStyle(2);  l3->Draw();    TLatex *lcut;   //lcut = new TLatex(xVal,0.88,Form("Keep only l_{J/#psi} < %4.3f mm",lCut));  lcut = new TLatex(xVal,0.88,Form("Keep only c#tau^{3D} < %4.3f mm",lCut));  if(significance) lcut = new TLatex(xVal,0.88,Form("Keep only c#tau^{3D}/err_c#tau^{3D} < %4.3f",lCut));  lcut->SetTextSize(0.033);  TLatex *leff = new TLatex(xVal,0.80,Form("#varepsilon_{prompt} = %4.3f",efficiency));  leff->SetTextSize(0.033);  TLatex *lrej = new TLatex(xVal,0.75,Form("1-#varepsilon_{non-prompt} = %4.3f",hNPCut->GetBinContent(lCutBin)));  lrej->SetTextSize(0.033);  lcut->Draw();  leff->Draw();  lrej->Draw();  leg->Draw();  std::cout << "RMS = " << hPR->GetRMS()*1000 << " μm" << std::endl;  if (savePlot) {    c1->SaveAs(plotDir+fname);    c1->SaveAs(plotDir+fnamepng);    TFile *outf = new TFile(plotDir+outfname,"RECREATE");    hPR->Write();    hNP->Write();    outf->Close();  }  TCanvas *c2 = new TCanvas("c2","c2");  c2->cd();  hRatio_fb1->Draw("hist");  hRatio_fb2->Draw("histsame");  hRatio_fb3->Draw("histsame");  hRatio_fb5->Draw("histsame");  hRatio_fb7->Draw("histsame");  std::cout << "fb = 0.1: " << hRatio_fb1->GetXaxis()->GetBinLowEdge(hRatio_fb1->GetMaximumBin()) << std::endl;  std::cout << "fb = 0.2: " << hRatio_fb2->GetXaxis()->GetBinLowEdge(hRatio_fb2->GetMaximumBin()) << std::endl;  std::cout << "fb = 0.3: " << hRatio_fb3->GetXaxis()->GetBinLowEdge(hRatio_fb3->GetMaximumBin()) << std::endl;  std::cout << "fb = 0.5: " << hRatio_fb5->GetXaxis()->GetBinLowEdge(hRatio_fb5->GetMaximumBin()) << std::endl;  std::cout << "fb = 0.7: " << hRatio_fb7->GetXaxis()->GetBinLowEdge(hRatio_fb7->GetMaximumBin()) << std::endl;  return;}